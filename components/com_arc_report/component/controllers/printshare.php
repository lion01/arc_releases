<?php
/**
 * @package     Arc
 * @subpackage  Report
 * @copyright   Copyright (C) 2005 Punnet. All rights reserved. See COPYRIGHT_ARC.txt
 * @license     http://www.gnu.org/licenses/gpl.html GNU/GPL. See LICENSE_ARC.txt
 * Arc is free software: you can redistribute it and/or modify
 * it under the terms of version 3 of the GNU General Public License
 * as published by the Free Software Foundation.
 * The disclaimer of warranty as stated in the GPL applies to this program
 */

defined( '_JEXEC' ) or die( 'Restricted access' );

/**
 * Report Controller Printshare
 *
 * @author     Punnet - Arc Team <arc_developers@pun.net>
 * @package    Arc
 * @subpackage Report
 * @since      1.8
 */
class ReportControllerPrintshare extends ReportController
{
	function display()
	{
		$model = $this->getModel( 'printshare' );
		$view = &$this->getView ( 'printshare', 'html' );
		$navView = &$this->getView ( 'nav', 'html' );
		
		$fCrumbs = ApothFactory::_( 'core.breadcrumb' );
		$fCrumbs->setPersistent( 'instances',    true, ARC_PERSIST_ALWAYS );
		$fCrumbs->setPersistent( 'searches',     true, ARC_PERSIST_ALWAYS );
		$fCrumbs->setPersistent( 'structures',   true, ARC_PERSIST_ALWAYS );
		$fCrumbs->setPersistent( 'searchParams', true, ARC_PERSIST_ALWAYS );
		$crumb = $fCrumbs->addBreadCrumb( ARC_REPORT_CRUMB_TRAIL, 'Print & Share', ApotheosisLibAcl::getUserLinkAllowed( 'apoth_report_writecheck' ) );
		$fCrumbs->curtailTrail( ARC_REPORT_CRUMB_TRAIL, $crumb->getId() );
		
		// **** for dev, pre-select a report or two to render
		// **** this will be done via the web-form when that's made
		$navModel = $this->getModel( 'nav' );
//*
//		$navModel->setFilterValues( array( 'cycle'=>2, 'student'=>array('GB-19970326-0001-5') ));
		$navModel->setFilterValues( array( 'cycle'=>2, 'student'=>array('GB-19970430-0001-5', 'GB-19970827-0003-8', 'GB-19970104-0001-6') ));
//		$navModel->setFilterValues( array( 'cycle'=>2, 'student'=>array('GB-19970123-0001-6', 'GB-19970401-0001-6', 'GB-19970410-0001-7') ));
// */
// /* 13641 	11A1 */ $navModel->setFilterValues( array( 'cycle'=>2, 'student'=>array( 'GB-19970430-0001-5', 'GB-19970827-0003-8', 'GB-19970326-0001-5', 'GB-19970617-0001-7', 'GB-19970109-0001-5', 'GB-19970410-0001-7', 'GB-19970415-0002-4', 'GB-19961204-0002-3', 'GB-19970118-0001-6', 'GB-19970514-0002-4', 'GB-19970630-0001-0', 'GB-19970115-0002-0', 'GB-19970410-0003-3', 'GB-19970705-0001-0', 'GB-19970122-0001-8', 'GB-19961105-0001-4', 'GB-19970316-0001-6', 'GB-19970427-0001-1', 'GB-19961203-0002-5', 'GB-19970512-0001-0', 'GB-19960912-0001-4', 'GB-19970511-0001-2', 'GB-19970608-0001-6', 'GB-19970104-0001-6', 'GB-19970205-0002-9', 'GB-19970629-0002-0', 'GB-19960905-0003-4', 'GB-19960917-0001-3', 'GB-19970120-0001-2', 'GB-19970604-0003-1', 'GB-19970401-0001-6', 'GB-19970216-0003-4' ) ));
// /* 13635 	11A2 */ $navModel->setFilterValues( array( 'cycle'=>2, 'student'=>array( 'GB-19970123-0001-6', 'GB-19960905-0002-6', 'GB-19970627-0002-4', 'GB-19970310-0002-7', 'GB-19960913-0001-2', 'GB-19970814-0003-6', 'GB-19970331-0002-3', 'GB-19970317-0001-4', 'GB-19961205-0002-0', 'GB-19970402-0001-4', 'GB-19961215-0001-1', 'GB-19970301-0001-8', 'GB-19970717-0002-3', 'GB-19961228-0003-0', 'GB-19961109-0003-2', 'GB-19970830-0002-4', 'GB-19961209-0002-2', 'GB-19970308-0001-3', 'GB-19970820-0002-5', 'GB-19970313-0001-3', 'GB-19970412-0002-1', 'GB-19970623-0001-5', 'GB-19970117-0002-6', 'GB-19970707-0001-6', 'GB-19961030-0002-2', 'GB-19970524-0001-5', 'GB-19970620-0001-1', 'GB-19970614-0001-4', 'GB-19960902-0005-6', 'GB-19960930-0001-6', 'GB-19970418-0003-6' ) ));
// /* 13643 	11B1 */ $navModel->setFilterValues( array( 'cycle'=>2, 'student'=>array( 'GB-19961119-0001-5', 'GB-19970813-0001-2', 'GB-19970129-0002-1', 'GB-19961015-0001-5', 'GB-19970721-0001-7', 'GB-19961013-0003-6', 'GB-19961029-0002-4', 'GB-19970922-0001-1', 'GB-19970207-0004-1', 'GB-19970323-0002-0', 'GB-19961127-0001-8', 'GB-19970626-0002-6', 'GB-19961012-0003-8', 'GB-19970206-0002-7', 'GB-19970416-0001-4', 'GB-19970413-0001-1', 'GB-19970731-0002-4', 'GB-19970714-0001-2', 'GB-19970107-0002-7', 'GB-19970213-0002-3', 'GB-19970629-0001-2', 'GB-19970820-0001-7', 'GB-19970417-0001-2', 'GB-19961122-0001-9', 'GB-19970530-0001-2', 'GB-19970501-0001-3', 'GB-19970709-0001-2', 'GB-19970602-0001-9', 'GB-19970407-0001-3', 'GB-19970425-0001-5' ) ));
// /* 13642 	11B2 */ $navModel->setFilterValues( array( 'cycle'=>2, 'student'=>array( 'GB-19970604-0001-5', 'GB-19960922-0001-3', 'GB-19970412-0001-3', 'GB-19970517-0001-9', 'GB-19970217-0001-6', 'GB-19960930-0002-4', 'GB-19970715-0002-7', 'GB-19961111-0001-2', 'GB-19970621-0001-9', 'GB-19960929-0001-8', 'GB-19970327-0001-3', 'GB-19970409-0001-9', 'GB-19970321-0001-6', 'GB-19970206-0001-9', 'GB-19970403-0002-0', 'GB-19970426-0002-1', 'GB-19970820-0003-3', 'GB-19960925-0002-4', 'GB-19961212-0001-8', 'GB-19961022-0001-1', 'GB-19961207-0002-6', 'GB-19970719-0001-1', 'GB-19970117-0003-4', 'GB-19970507-0001-0', 'GB-19961117-0001-9', 'GB-19970711-0003-4', 'GB-19961007-0002-0', 'GB-19970825-0001-6', 'GB-19970503-0001-9', 'GB-19961107-0001-0', 'GB-19961224-0002-1', 'GB-19970619-0001-3', 'GB-19970827-0002-0' ) ));
// /* 13638 	11D1 */ $navModel->setFilterValues( array( 'cycle'=>2, 'student'=>array( 'GB-19970826-0001-4', 'GB-19970610-0003-8', 'GB-19960906-0001-6', 'GB-19970703-0002-3', 'GB-19970323-0001-2', 'GB-19970424-0003-4', 'GB-19961211-0002-8', 'GB-19970611-0001-0', 'GB-19961101-0001-3', 'GB-19970207-0001-7', 'GB-19970517-0002-7', 'GB-19970518-0002-5', 'GB-19961029-0001-6', 'GB-19970718-0003-9', 'GB-19970216-0004-2', 'GB-19960907-0001-4', 'GB-19970105-0001-3', 'GB-19970322-0002-2', 'GB-19970430-0002-3', 'GB-19970301-0002-6', 'GB-19960902-0002-3', 'GB-19970805-0001-8', 'GB-19970809-0001-0', 'GB-19970401-0002-4', 'GB-19960902-0003-1', 'GB-19960925-0001-6', 'GB-19970731-0001-6', 'GB-19960920-0001-7', 'GB-19970513-0001-8', 'GB-19961027-0001-0' ) ));
// /* 13639 	11D2 */ $navModel->setFilterValues( array( 'cycle'=>2, 'student'=>array( 'GB-19970812-0001-4', 'GB-19970310-0001-9', 'GB-19970724-0001-1', 'GB-19961025-0001-4', 'GB-19970105-0002-1', 'GB-19961106-0001-2', 'GB-19970207-0002-5', 'GB-19970403-0001-2', 'GB-19960924-0001-9', 'GB-19960127-0003-5', 'GB-19961011-0001-4', 'GB-19961229-0002-0', 'GB-19970422-0001-2', 'GB-19970723-0001-3', 'GB-19970828-0001-0', 'GB-19970602-0002-7', 'GB-19961216-0002-7', 'GB-19970127-0001-7', 'GB-19970116-0001-0', 'GB-19961201-0001-1', 'GB-19960905-0001-8', 'GB-19970207-0003-3', 'GB-19970114-0001-5', 'GB-19970810-0001-8', 'GB-19960908-0001-2', 'GB-19961101-0002-1', 'GB-19970204-0001-4', 'GB-19961230-0001-0', 'GB-19970425-0003-1', 'GB-19961027-0002-8' ) ));
// /* 13636 	11J1 */ $navModel->setFilterValues( array( 'cycle'=>2, 'student'=>array( 'GB-19970104-0002-4', 'GB-19970323-0003-8', 'GB-19970125-0002-9', 'GB-19961213-0001-6', 'GB-19970307-0002-3', 'GB-19970703-0001-5', 'GB-19961220-0001-1', 'GB-19970428-0002-7', 'GB-19961221-0001-9', 'GB-19970604-0002-3', 'GB-19970227-0001-5', 'GB-19961113-0001-8', 'GB-19961109-0001-6', 'GB-19961022-0002-9', 'GB-19970825-0003-2', 'GB-19970707-0003-2', 'GB-19970610-0002-0', 'GB-19970622-0001-7', 'GB-19961102-0001-1', 'GB-19970329-0001-9', 'GB-19970522-0001-9', 'GB-19970711-0001-8', 'GB-19970819-0001-9', 'GB-19970410-0002-5', 'GB-19961227-0002-4', 'GB-19961017-0001-1', 'GB-19970306-0002-5', 'GB-19970824-0001-9', 'GB-19970117-0001-8', 'GB-19970107-0001-9', 'GB-19961014-0002-6', 'GB-19970408-0001-1' ) ));
// /* 13634 	11J2 */ $navModel->setFilterValues( array( 'cycle'=>2, 'student'=>array( 'GB-19961225-0005-1', 'GB-19961203-0003-3', 'GB-19970420-0001-6', 'GB-19961003-0001-1', 'GB-19970722-0001-5', 'GB-19961223-0001-5', 'GB-19970514-0001-6', 'GB-19961001-0001-5', 'GB-19961010-0001-6', 'GB-19970724-0002-9', 'GB-19970705-0002-8', 'GB-19970601-0001-1', 'GB-19961116-0002-9', 'GB-19960923-0001-1', 'GB-19961122-0002-7', 'GB-19961206-0001-0', 'GB-19970413-0003-7', 'GB-19970218-0001-4', 'GB-19960924-0002-7', 'GB-19970106-0001-1', 'GB-19970325-0003-3', 'GB-19970707-0002-4', 'GB-19970216-0002-6', 'GB-19961030-0003-0', 'GB-19970102-0001-0', 'GB-19970827-0001-2', 'GB-19970724-0003-7', 'GB-19961001-0002-3', 'GB-19970428-0001-9', 'GB-19961218-0001-5', 'GB-19961203-0001-7' ) ));
// /* 13640 	11P1 */ $navModel->setFilterValues( array( 'cycle'=>2, 'student'=>array( 'GB-19961125-0002-0', 'GB-19961116-0001-1', 'GB-19970408-0002-9', 'GB-19970620-0002-9', 'GB-19970803-0001-3', 'GB-19961224-0001-3', 'GB-19961025-0004-8', 'GB-19961025-0002-2', 'GB-19970625-0002-8', 'GB-19970711-0002-6', 'GB-19970227-0002-3', 'GB-19961028-0001-8', 'GB-19961230-0002-8', 'GB-19970516-0001-1', 'GB-19970713-0001-4', 'GB-19970325-0001-7', 'GB-19961225-0001-0', 'GB-19961207-0001-8', 'GB-19970706-0001-8', 'GB-19960924-0003-5', 'GB-19970531-0001-0', 'GB-19970705-0003-6', 'GB-19970830-0001-6', 'GB-19970214-0001-3', 'GB-19970718-0002-1', 'GB-19970324-0001-0', 'GB-19970612-0001-8', 'GB-19970413-0002-9', 'GB-19970127-0002-5', 'GB-19961222-0001-7' ) ));
// /* 13633 	11P2 */ $navModel->setFilterValues( array( 'cycle'=>2, 'student'=>array( 'GB-19970318-0001-2', 'GB-19961222-0002-5', 'GB-19961012-0001-2', 'GB-19961030-0001-4', 'GB-19970226-0001-7', 'GB-19961008-0001-0', 'GB-19970610-0001-2', 'GB-19970715-0001-9', 'GB-19961021-0001-3', 'GB-19961125-0003-8', 'GB-19970414-0001-9', 'GB-19961123-0001-7', 'GB-19961209-0001-4', 'GB-19970129-0001-3', 'GB-19970404-0001-0', 'GB-19960921-0001-5', 'GB-19970620-0003-7', 'GB-19960923-0002-9', 'GB-19961125-0005-3', 'GB-19960924-0004-3', 'GB-19970321-0003-2', 'GB-19961109-0002-4', 'GB-19961211-0001-0', 'GB-19970314-0001-1', 'GB-19970515-0001-3', 'GB-19970306-0001-7', 'GB-19970424-0002-6', 'GB-19970804-0001-1', 'GB-19970814-0001-0', 'GB-19970425-0002-3', 'GB-19970320-0001-8', 'GB-19961103-0001-9', 'GB-19970213-0001-5' ) ));
// /* 13637 	11S1 */ $navModel->setFilterValues( array( 'cycle'=>2, 'student'=>array( 'GB-19970214-0002-1', 'GB-19961225-0002-8', 'GB-19970814-0002-8', 'GB-19961229-0001-2', 'GB-19970626-0001-8', 'GB-19970205-0001-1', 'GB-19970531-0002-8', 'GB-19970210-0002-9', 'GB-19970606-0001-0', 'GB-19970618-0001-5', 'GB-19961217-0001-7', 'GB-19960915-0001-7', 'GB-19970628-0001-4', 'GB-19970322-0001-4', 'GB-19970217-0002-4', 'GB-19970811-0001-6', 'GB-19960902-0001-5', 'GB-19970704-0001-3', 'GB-19970124-0001-4', 'GB-19961216-0001-9', 'GB-19970723-0002-1', 'GB-19970418-0001-0', 'GB-19960911-0001-6', 'GB-19970818-0001-1', 'GB-19970522-0002-7', 'GB-19961228-0001-4', 'GB-19970728-0001-2', 'GB-19970424-0001-8', 'GB-19970520-0001-3', 'GB-19970421-0001-4', 'GB-19961014-0001-8', 'GB-19970627-0001-6' ) ));
// /* 13644 	11S2 */ $navModel->setFilterValues( array( 'cycle'=>2, 'student'=>array( 'GB-19961205-0001-2', 'GB-19960910-0001-8', 'GB-19970115-0001-2', 'GB-19961227-0001-6', 'GB-19961225-0007-7', 'GB-19960902-0004-9', 'GB-19970325-0002-5', 'GB-19961013-0001-0', 'GB-19961225-0004-4', 'GB-19970816-0001-5', 'GB-19961129-0001-4', 'GB-19961225-0003-6', 'GB-19970623-0002-3', 'GB-19970501-0002-1', 'GB-19961007-0001-2', 'GB-19970331-0001-5', 'GB-19970512-0002-8', 'GB-19970311-0001-7', 'GB-19970109-0002-3', 'GB-19970518-0001-7', 'GB-19970331-0004-9', 'GB-19960909-0002-8', 'GB-19970528-0001-6', 'GB-19970321-0002-4', 'GB-19970131-0001-9', 'GB-19961206-0002-8', 'GB-19970815-0001-7', 'GB-19970404-0002-8', 'GB-19970530-0002-0', 'GB-19970625-0001-0', 'GB-19970525-0001-2' ) ));
// /* 2 copies */ $navModel->setFilterValues( array( 'cycle'=>2, 'student'=>array( 'GB-19970310-0001-9', 'GB-19970109-0001-5', 'GB-19961015-0001-5', 'GB-19961225-0007-7', 'GB-19970415-0002-4', 'GB-19961211-0002-8', 'GB-19970606-0001-0', 'GB-19961010-0001-6', 'GB-19970321-0001-6', 'GB-19961225-0003-6', 'GB-19970518-0002-5', 'GB-19961209-0001-4', 'GB-19970723-0002-1', 'GB-19961125-0005-3', 'GB-19970731-0002-4', 'GB-19960902-0002-3', 'GB-19970213-0002-3', 'GB-19960908-0001-2', 'GB-19970314-0001-1', 'GB-19961017-0001-1', 'GB-19970501-0001-3', 'GB-19970824-0001-9', 'GB-19961014-0002-6', 'GB-19961218-0001-5', 'GB-19970408-0001-1' );

// no crops...
// /* to be emailed */ $navModel->setFilterValues( array( 'cycle'=>2, 'student'=>array( 'GB-19970409-0001-9', 'GB-19961213-0001-6', 'GB-19961225-0004-4', 'GB-19970117-0001-8', 'GB-19961227-0001-6', 'GB-19970120-0001-2', 'GB-19961228-0001-4', 'GB-19961011-0001-4', 'GB-19970210-0002-9', 'GB-19970610-0003-8', 'GB-19970721-0001-7', 'GB-19970109-0001-5', 'GB-19970804-0001-1', 'GB-19961001-0001-5', 'GB-19970520-0001-3', 'GB-19970512-0002-8', 'GB-19970107-0001-9', 'GB-19961125-0002-0', 'GB-19961218-0001-5', 'GB-19961220-0001-1', 'GB-19970522-0001-9', 'GB-19970826-0001-4', 'GB-19960923-0001-1', 'GB-19970814-0002-8', 'GB-19970507-0001-0', 'GB-19961230-0002-8', 'GB-19970408-0002-9', 'GB-19961225-0005-1', 'GB-19970530-0002-0', 'GB-19970514-0001-6', 'GB-19960924-0002-7', 'GB-19970428-0001-9', 'GB-19970610-0002-0', 'GB-19970827-0002-0', 'GB-19970301-0002-6', 'GB-19961125-0003-8', 'GB-19970105-0001-3', 'GB-19961224-0001-3', 'GB-19970711-0003-4', 'GB-19970310-0002-7', 'GB-19961003-0001-1', 'GB-19970717-0002-3', 'GB-19960924-0001-9', 'GB-19970125-0002-9', 'GB-19970522-0001-9', 'GB-19970216-0002-6', 'GB-19970610-0003-8', 'GB-19970424-0003-4', 'GB-19961122-0002-7', 'GB-19970820-0002-5', 'GB-19970205-0002-9', 'GB-19970514-0002-4', 'GB-19970517-0001-9', 'GB-19970317-0001-4', 'GB-19970216-0004-2', 'GB-19970105-0002-1' );
		
		$view->nav = &$navView;
		$view->setModel( $model, true );
		$view->display();
		
		$this->saveModel( 'printshare' );
		$this->saveModel( 'nav' );
	}
	
	function preview()
	{
		plgSystemArc_log::startTimer( 'report controllerPrintshare save' );
//		dump( memory_get_usage(), 'mem usage at start' );
		$model = $this->getModel( 'printshare' );
		$view = &$this->getView ( 'printshare', 'apothpdf' );
		$navModel = $this->getModel( 'nav' );
		
		$model->setSearch( $navModel->getFilterValues() );
		
		if( $model->getCycle() === false ) {
			$display = ApotheosisLibAcl::getUserLinkAllowed( 'apoth_report_printshare', array( 'view'=>'printshare' ) );
			$this->saveAndRedirect( $display, 'No cycle selected', 'notice' );
		}
		
		$view->setModel( $model, true );
		$view->display();
		
//		dump( memory_get_usage(), 'mem usage at end' );
//		$this->saveModel();
		plgSystemArc_log::stopTimer( 'report controllerPrintshare save' );
	}
	
	function save()
	{
		plgSystemArc_log::startTimer( 'report controllerPrintshare save' );
//		dump( memory_get_usage(), 'mem usage at start' );
		$model = $this->getModel( 'printshare' );
		$view = &$this->getView ( 'printshare', 'apothpdf' );
		$navModel = $this->getModel( 'nav' );
		
		$model->setSearch( $navModel->getFilterValues() );
		
		if( $model->getCycle() === false ) {
			$display = ApotheosisLibAcl::getUserLinkAllowed( 'apoth_report_printshare', array( 'view'=>'printshare' ) );
			$this->saveAndRedirect( $display, 'No cycle selected', 'notice' );
		}
		
		$view->setModel( $model, true );
		$view->display();
		
//		dump( memory_get_usage(), 'mem usage at end' );
//		$this->saveModel();
		plgSystemArc_log::stopTimer( 'report controllerPrintshare save' );
	}
}
?>